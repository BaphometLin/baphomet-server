<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Baphomet Server - ì—…ë°ì´íŠ¸</title>

<style>
/* ------------------------------
   ì „ì²´ ë°°ê²½ í†µì¼ (ëª¨ë“  ë©”ë‰´ì™€ ë™ì¼)
------------------------------ */
html {
    background: url('images/background_full.jpg') no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
}
body {
    margin: 0;
    background: transparent;
    color: #ddd;
    font-family: "Malgun Gothic", Arial, sans-serif;
}
body::before {
    content:"";
    position: fixed;
    inset:0;
    background: rgba(0,0,0,0.18);
    pointer-events: none;
    z-index: 0;
}

.footer {
    margin-top: 60px;
    padding: 15px 0;
    font-size: 14px;
    color: rgba(230, 230, 230, 0.75);
    text-align: center;
    line-height: 1.4;
    position: relative;
    z-index: 10;
}

/* ------------------------------
   ìƒë‹¨ ë©”ë‰´
------------------------------ */
.navbar {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(0,0,0,0.55);
    padding: 14px 0;
    border-bottom: 1px solid rgba(255,0,0,0.25);
    z-index: 1000;
    text-align: center;
}
.navbar a {
    color: #ddd;
    margin: 0 28px;
    font-size: 19px;
    font-weight: bold;
    text-decoration: none;
}
.navbar a:hover {
    color: #ff3333;
    border-bottom: 2px solid #ff3333;
    text-shadow: 0 0 8px #ff0000;
}

/* ------------------------------
   ìƒë‹¨ ë°°ë„ˆ
------------------------------ */
.header {
    background-image: url('images/baphomet2.jpg');
    background-size: cover;
    background-position: center;
    height: 520px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 5;
}
.header::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.25);
}
.header::after {
    content:"";
    position:absolute;
    bottom:-1px;
    width:100%;
    height:350px;
    background: linear-gradient(
        to bottom,
        rgba(0,0,0,0) 0%,
        rgba(0,0,0,0.25) 30%,
        rgba(0,0,0,0.55) 65%,
        rgba(0,0,0,0.9) 100%
    );
}

.header h1 {
    position: relative;
    font-size: 43px;
    font-weight: bold;
    letter-spacing: 4px;
    color: #fff;
    text-shadow: 0 0 10px #000, 0 0 20px #990000;
    top: 60px;
    z-index: 10;
}

/* ------------------------------
   ë³¸ë¬¸ ì»¨í…Œì´ë„ˆ
------------------------------ */
.container {
    width: 1000px;
    margin: 120px auto 70px auto;
    padding-bottom: 80px;
    position: relative;
    z-index: 10;
}

h2 {
    font-size: 32px;
    color: #ff4444;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 0 0 10px #900;
}

/* ------------------------------
    ê²€ìƒ‰ ì˜ì—­
------------------------------ */
.search-box {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    gap: 10px;
}
.search-box-left {
    display: flex;
    gap: 8px;
    align-items: center;
}
.search-input {
    padding: 8px 10px;
    width: 260px;
    background: #111;
    border: 1px solid #555;
    color: #ddd;
    border-radius: 5px;
    font-size: 15px;
}
.btn {
    padding: 8px 14px;
    background: #660000;
    color: #fff;
    border: 1px solid #ff4444;
    border-radius: 6px;
    cursor: pointer;
    font-size: 15px;
    transition: 0.2s;
    white-space: nowrap;
}
.btn:hover {
    background: #990000;
    box-shadow: 0 0 10px #ff4444;
}

/* ------------------------------
    ê²Œì‹œíŒ í…Œì´ë¸”
------------------------------ */
table.board {
    width: 100%;
    border-collapse: collapse;
    background: rgba(0,0,0,0.65);
    border: 1px solid rgba(255,30,30,0.4);
    border-radius: 8px;
    overflow: hidden;
}
table.board thead {
    background: rgba(60,0,0,0.8);
}
table.board th, table.board td {
    padding: 10px 8px;
    border-bottom: 1px solid rgba(255,255,255,0.07);
    font-size: 15px;
    text-align: center;
}
table.board th:nth-child(2),
table.board td:nth-child(2) {
    text-align: left;
}
table.board tr:hover td {
    background: rgba(255,0,0,0.08);
}
.title-link {
    color: #ddd;
    text-decoration: none;
}
.title-link:hover {
    color: #ffcc00;
    text-shadow: 0 0 6px #ffcc00;
}

/* ------------------------------
   ê´€ë¦¬ ë²„íŠ¼
------------------------------ */
.manage-btn {
    padding: 4px 8px;
    margin: 1px;
    background: #444;
    border-radius: 4px;
    border: 1px solid #777;
    font-size: 12px;
    cursor: pointer;
    color: #fff;
}
.manage-btn.edit {
    background: #225588;
    border-color: #5599dd;
}
.manage-btn.delete {
    background: #884444;
    border-color: #dd7777;
}

/* ------------------------------
   í˜ì´ì§•
------------------------------ */
.pagination {
    margin-top: 15px;
    text-align: center;
}
.pagination button {
    background: #222;
    border: 1px solid #555;
    color: #ddd;
    padding: 5px 10px;
    margin: 0 2px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}
.pagination button.active {
    background: #aa0000;
    border-color: #ff4444;
    font-weight: bold;
}
.pagination button:hover {
    background: #444;
}

/* ------------------------------
   ìƒì„¸ ëª¨ë‹¬
------------------------------ */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}
.modal {
    width: 650px;
    max-height: 80vh;
    overflow-y: auto;
    background: #111;
    border-radius: 10px;
    padding: 20px 24px;
    border: 1px solid #ff4444;
    box-shadow: 0 0 20px rgba(255,0,0,0.6);
}
.modal-title {
    font-size: 22px;
    color: #ffcc00;
    margin-bottom: 5px;
}
.modal-date {
    font-size: 13px;
    color: #aaa;
    margin-bottom: 15px;
}
.modal-content {
    font-size: 16px;
    line-height: 1.6;
    white-space: pre-line;
}
.modal-close {
    margin-top: 18px;
    text-align: right;
}
.modal-close button {
    padding: 7px 14px;
    background: #660000;
    border-radius: 6px;
    border: 1px solid #ff4444;
    cursor: pointer;
    color: #fff;
}
</style>

<script>
const PAGE_SIZE = 10;
let updates = [];      // ì „ì²´ ë°ì´í„°
let filtered = [];     // ê²€ìƒ‰ëœ ë°ì´í„°
let currentPage = 1;
let adminMode = false;

window.addEventListener("load", () => {
    loadUpdates();
});

// ----------------------------------------
// ì—…ë°ì´íŠ¸ ë°ì´í„° ë¡œë“œ + ë§ˆì´ê·¸ë ˆì´ì…˜ + ì •ë ¬
// ----------------------------------------
function loadUpdates() {
    let list = JSON.parse(localStorage.getItem("updates") || "[]");

    // âœ… [ì¶”ê°€] ì²˜ìŒ ì ‘ì†(ë°ì´í„° ì—†ìŒ)ì¼ ë•Œ ê¸°ë³¸ ì—…ë°ì´íŠ¸ 1ê°œ ìë™ ìƒì„±
    if (list.length === 0) {
        const today = new Date().toISOString().substring(0, 10);
        list.push({
            id: Date.now(),
            title: "ì—…ë°ì´íŠ¸ ì‚¬í•­ì€ ì„œë²„ë‚´ ë˜ëŠ” ë‹¨í†¡ë°© ì°¸ì¡°",
            content: "ì—…ë°ì´íŠ¸ ì‚¬í•­ì€ ì„œë²„ë‚´ ë˜ëŠ” ë‹¨í†¡ë°© ì°¸ì¡°",
            date: today,
            createdAt: today + "T00:00:00"
        });
    }

    list.forEach((u, idx) => {
        if (!u.id) u.id = Date.now() + idx;
        if (!u.createdAt) {
            if (u.date && /^\d{4}-\d{2}-\d{2}$/.test(u.date)) {
                u.createdAt = u.date + "T00:00:00";
            } else {
                u.createdAt = new Date().toISOString();
            }
        }
    });

    list.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

    updates = list;
    filtered = [...updates];

    localStorage.setItem("updates", JSON.stringify(updates));
    renderBoard();
}

// ----------------------------------------
// ê²Œì‹œíŒ ë Œë”ë§
// ----------------------------------------
function renderBoard() {
    const tbody = document.getElementById("boardBody");
    const pagination = document.getElementById("pagination");

    tbody.innerHTML = "";
    pagination.innerHTML = "";

    if (filtered.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 4;
        td.textContent = "ë“±ë¡ëœ ì—…ë°ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
    }

    const total = filtered.length;
    const totalPages = Math.ceil(total / PAGE_SIZE);
    if (currentPage > totalPages) currentPage = totalPages;

    const start = (currentPage - 1) * PAGE_SIZE;
    const end = start + PAGE_SIZE;
    const pageItems = filtered.slice(start, end);

    pageItems.forEach((u, idx) => {
        const tr = document.createElement("tr");

        // ë²ˆí˜¸
        const noTd = document.createElement("td");
        noTd.textContent = total - (start + idx);
        tr.appendChild(noTd);

        // ì œëª©
        const titleTd = document.createElement("td");
        const a = document.createElement("a");
        a.className = "title-link";
        a.textContent = u.title;
        a.href = "javascript:void(0)";
        a.onclick = () => openDetail(u.id);
        titleTd.appendChild(a);
        tr.appendChild(titleTd);

        // ë‚ ì§œ
        const dateTd = document.createElement("td");
        dateTd.textContent = u.date || u.createdAt.substring(0,10);
        tr.appendChild(dateTd);

        // ê´€ë¦¬
        const manageTd = document.createElement("td");
        if (adminMode) {
            const btnEdit = document.createElement("button");
            btnEdit.className = "manage-btn edit";
            btnEdit.textContent = "ìˆ˜ì •";
            btnEdit.onclick = (e) => {
                e.stopPropagation();
                editUpdate(u.id);
            };

            const btnDelete = document.createElement("button");
            btnDelete.className = "manage-btn delete";
            btnDelete.textContent = "ì‚­ì œ";
            btnDelete.onclick = (e) => {
                e.stopPropagation();
                deleteUpdate(u.id);
            };

            manageTd.appendChild(btnEdit);
            manageTd.appendChild(btnDelete);
        } else {
            manageTd.textContent = "-";
        }
        tr.appendChild(manageTd);

        tbody.appendChild(tr);
    });

    // í˜ì´ì§• ì²˜ë¦¬
    const totalPages2 = Math.ceil(filtered.length / PAGE_SIZE);

    if (totalPages2 > 1) {
        // ì´ì „
        const prevBtn = document.createElement("button");
        prevBtn.textContent = "ì´ì „";
        prevBtn.disabled = currentPage === 1;
        prevBtn.onclick = () => { currentPage--; renderBoard(); };
        pagination.appendChild(prevBtn);

        // í˜ì´ì§€ ë²ˆí˜¸
        for (let p = 1; p <= totalPages2; p++) {
            const btn = document.createElement("button");
            btn.textContent = p;
            if (p === currentPage) btn.classList.add("active");
            btn.onclick = () => { currentPage = p; renderBoard(); };
            pagination.appendChild(btn);
        }

        // ë‹¤ìŒ
        const nextBtn = document.createElement("button");
        nextBtn.textContent = "ë‹¤ìŒ";
        nextBtn.disabled = currentPage === totalPages2;
        nextBtn.onclick = () => { currentPage++; renderBoard(); };
        pagination.appendChild(nextBtn);
    }
}

// ----------------------------------------
// ê²€ìƒ‰ ê¸°ëŠ¥
// ----------------------------------------
function searchUpdates() {
    const keyword = document.getElementById("searchInput").value.trim().toLowerCase();

    if (!keyword) {
        filtered = [...updates];
    } else {
        filtered = updates.filter(u =>
            (u.title && u.title.toLowerCase().includes(keyword)) ||
            (u.content && u.content.toLowerCase().includes(keyword))
        );
    }

    currentPage = 1;
    renderBoard();
}

// ----------------------------------------
// ê´€ë¦¬ì ëª¨ë“œ
// ----------------------------------------
function enableAdminMode() {
    if (adminMode) {
        adminMode = false;
        alert("ê´€ë¦¬ì ëª¨ë“œ OFF");
        renderBoard();
        return;
    }

    let pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    let real = atob("d2pkYWxzcnVkMSE="); // wjdalsrud1!

    if (pw !== real) {
        alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜!");
        return;
    }

    adminMode = true;
    alert("ê´€ë¦¬ì ëª¨ë“œ ON");
    renderBoard();
}

// ----------------------------------------
// ê¸€ì“°ê¸° ì´ë™
// ----------------------------------------
function openWritePage() {
    if (!adminMode) {
        let pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        let real = atob("d2pkYWxzcnVkMSE=");
        if (pw !== real) {
            alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜!");
            return;
        }
        adminMode = true;
    }
    location.href = "update_write.html";
}

// ----------------------------------------
// ìƒì„¸ë³´ê¸° ëª¨ë‹¬
// ----------------------------------------
function openDetail(id) {
    const u = updates.find(x => x.id === id);
    if (!u) return;

    document.getElementById("modalTitle").textContent = u.title;
    document.getElementById("modalDate").textContent =
        u.date || u.createdAt.substring(0,10);
    document.getElementById("modalContent").textContent =
        u.content || "";

    document.getElementById("modalOverlay").style.display = "flex";
}

function closeModal() {
    document.getElementById("modalOverlay").style.display = "none";
}

// ----------------------------------------
// ìˆ˜ì •
// ----------------------------------------
function editUpdate(id) {
    location.href = "update_edit.html?id=" + encodeURIComponent(id);
}

// ----------------------------------------
// ì‚­ì œ
// ----------------------------------------
function deleteUpdate(id) {
    if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    let list = JSON.parse(localStorage.getItem("updates") || "[]");
    list = list.filter(u => u.id !== id);
    localStorage.setItem("updates", JSON.stringify(list));

    updates = list;
    searchUpdates();
}
</script>
</head>

<body>

<!-- ìƒë‹¨ ë©”ë‰´ -->
<div class="navbar">
    <a href="index.html">í™ˆ</a>
    <a href="notice.html">ê³µì§€ì‚¬í•­</a>
    <a href="info.html">ì„œë²„ì •ë³´</a>
    <a href="update.html" style="color:#ff3333; border-bottom:2px solid #ff3333;">ì—…ë°ì´íŠ¸</a>
    <a href="boss.html">ë³´ìŠ¤ì •ë³´</a>
    <a href="promo.html">í™ë³´ì•ˆë‚´</a>
    <a href="service.html">ê³ ê°ì„¼í„°</a>
    <a href="download.html">ë‹¤ìš´ë¡œë“œ</a>
</div>

<!-- ë°°ë„ˆ -->
<div class="header">
    <h1>UPDATE</h1>
</div>

<!-- ë³¸ë¬¸ -->
<div class="container">
    <h2>ğŸ“¢ ìµœì‹  ì—…ë°ì´íŠ¸</h2>

    <div class="search-box">
        <div class="search-box-left">
            <input id="searchInput" class="search-input" type="text" placeholder="ì œëª© ë˜ëŠ” ë‚´ìš© ê²€ìƒ‰">
            <button class="btn" onclick="searchUpdates()">ê²€ìƒ‰</button>
            <button class="btn" onclick="document.getElementById('searchInput').value=''; searchUpdates();">ì „ì²´ë³´ê¸°</button>
        </div>

        <div>
            <button class="btn" onclick="openWritePage()">ì—…ë°ì´íŠ¸ ì‘ì„±</button>
            <button class="btn" onclick="enableAdminMode()">ê´€ë¦¬ì ëª¨ë“œ</button>
        </div>
    </div>

    <table class="board">
        <thead>
            <tr>
                <th style="width:60px;">ë²ˆí˜¸</th>
                <th>ì œëª©</th>
                <th style="width:120px;">ì‘ì„±ì¼</th>
                <th style="width:130px;">ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody id="boardBody"></tbody>
    </table>

    <div id="pagination" class="pagination"></div>
</div>

<!-- ìƒì„¸ ëª¨ë‹¬ -->
<div id="modalOverlay" class="modal-overlay">
    <div class="modal">
        <div class="modal-title" id="modalTitle"></div>
        <div class="modal-date" id="modalDate"></div>
        <div class="modal-content" id="modalContent"></div>
        <div class="modal-close">
            <button onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<!-- í•˜ë‹¨ -->
<div class="footer">
    ì„œë²„ì˜ ëª¨ë“  ì €ì‘ê¶Œì€ NCì†Œí”„íŠ¸ì— ìˆìœ¼ë©°, ë¦¬ë‹ˆì§€ ê°œë°œê³¼ ë°œì „, ì»¤ë®¤ë‹ˆí‹°ë¥¼ ìœ„í•œ ì„œë²„ì…ë‹ˆë‹¤.<br>
    ê²Œì„ì‚¬ì˜ ìš”ì²­ ì‹œ ì„œë²„ëŠ” ì–¸ì œë“ ì§€ ì¤‘ë‹¨ë  ìˆ˜ ìˆìŒì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.
</div>

</body>
</html>

<!-- ìˆ˜ì • ëª¨ë‹¬ (ì›ë³¸ì— ìˆë˜ ê·¸ëŒ€ë¡œ ìœ ì§€) -->
<div id="editModal" class="modal-overlay">
    <div class="modal">
        <h2 style="color:#ffcc00; margin-bottom:10px;">ì—…ë°ì´íŠ¸ ìˆ˜ì •</h2>

        <input type="hidden" id="editId">

        <div>
            <label style="color:#ccc;">ì œëª©</label><br>
            <input id="editTitle" type="text"
                   style="width:100%; padding:8px; margin:6px 0; background:#222; border:1px solid #555; color:#fff; border-radius:5px;">
        </div>

        <div>
            <label style="color:#ccc;">ë‚´ìš©</label><br>
            <textarea id="editContent"
                      style="width:100%; height:180px; padding:8px; margin-top:6px; background:#222; border:1px solid #555; color:#fff; border-radius:5px;"></textarea>
        </div>

        <div class="modal-close" style="margin-top:15px;">
            <button onclick="saveEdit()">ì €ì¥</button>
            <button onclick="closeEditModal()">ë‹«ê¸°</button>
        </div>
    </div>
</div>
